# Code Complete Notes

### 5. 关键的设计概念

1. 作为软件开发人员，我们不应该试着在同一时间把整个程序都塞进自己的大脑，而应该试着以某种方式去组织程序，以便能够在一个时刻可以专注于一个特定的部分。这么做的目的是尽量减少在任一时间锁要考虑的程序量。你可以把它想做是一种心理上的杂耍（边抛边接：通过轮流抛接使两个或两个以上物体同时保持与空中）—程序要求你保持的（精神上的）球越多，你就越可能漏掉其中的某一个，从而导致设计或者编码的错误。

2. 在软件架构的层次上，可以通过把整个系统分解为多个子系统来降低问题的复杂度。人类更容易理解许多项简单的信息，而不是一项复杂的信息。所有软件设计技术的目标都是把复杂问题分解为简单的部分。子系统间的相互依赖越少，你就越容易在同一时间里专注问题的一小部分。精心设计的对象关系使关注点相互分离，从而使你能在每个时刻只专注于一件事情。在更高汇聚的层次上，包提供了相同的好处。

3. 设计特征：

   **最小的复杂度**：应该做出简单且易于理解的设计；

   **易于维护**：这意味着在设计时为做维护工作的程序员考虑，设计出能自明（self-explanatory）的系统；

   **松散耦合**：这意味着在设计时让程序的各个组成部分之间关联最小。通过应用类接口中的合理抽象、封装性及信息隐藏等原则，设计出相互关联尽可能最少的类。减少关联也就减少了集成、测试与维护时的工作量；

   **可扩展性**：这是说在增强系统的功能而无须破坏其底层功能；

   **可重用性**：这意味着所设计的系统的组成部分能在其他系统中重复使用；

   **高扇入**：这是说大量的类使用某个给定的类，这意味着设计出的系统很好地利用了较底层次上的工具类（utility classes）；

   **低扇出**：这是说让一个类里少量或者适中地使用其他的类，高扇出（超过约 7 个）说明一个类使用了大量其他的类，因此可能变得过于复杂。无论考虑某个子程序调用其他子程序的量，还是考虑某个类使用其他类的量；

   **可移植性**：设计的系统很方便地移植到其他环境中；

   **精简性**：这意味着所设计的系统没有多余的部分。伏尔泰说，一本书的完成，不在于它不能再加入任何内容的时候，而在不能删除任何内容的时候。

   **层次性**：这意味着尽量保持系统各个分阶层的层次性，是你能在任意的层面上观察系统，并得到某种具有一致性的看法。设计出来的系统应该能在任意层次上观察而不需要进入其它层次。例如：在编写新系统时，其中用到很多设计不佳的旧代码，这是你就应该为新系统编一个负责同旧代码交互的层。在设计这一层时，要让它能隐藏旧代码的低劣质量，同时为新的层次提供一组一致的服务。这样，你的系统的其他部分就只需要与这一层进行交互，而无须直接同旧代码大交道了。

   **标准技术**：一个系统所依赖的外来的、古怪的东西越多，别人在第一次想要理解它的时候就越头疼。要尽量用标准化的、常用的方法，让整个系统给人一种熟悉的感觉。

4. 设计层次：**系统**首先被组织为**子系统**；子系统被进一步分解为**类**，然后类又被分解为**子程序和数据**；每个**子程序内部**也需要进行设计。

5. 在子系统这个层次设计时，不同子系统之间的相互通信的规则非常重要。如果所有子系统都能同其他子系统通信，就完全失去了把它们分开所带来的好处。应该通过限制子系统之间的通信来让每个子系统更有存在的意义。如果拿不准如何设计的话，那么应该先对子系统之间的通信加以限制，等日后需要时再放松。

6. 常用的子系统：

   **业务规则**：这是指在计算机系统中编入的规则以及过程；

   **用户界面**：用户界面组件应该同其他部分隔离开，以便使用户见面的演化不会破坏程序的其他部分；

   **数据库访问**：这可以把对数据库进行访问的实现细节隐藏起来，让程序的绝大部分可以不必关心处理底层结构的繁琐细节，并能像在业务层次一样处理数据。隐藏实现细节的子系统可以为系统提供有价值的抽象层，从而减少程序的复杂度。它把和数据库相关的操作集中起来，减少了在对数据进行操作时发生错误的几率。同时，它还能让数据库的设计结构更易于变化，做这种修改时无须修改程序的主要部分。

   **对系统的依赖性**：把对操作系统的依赖因素归到一个子系统里，就如同把对硬件的依赖因素封装起来一样。